/*! grunt-project 12-09-2014 */
$(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,ab,bb=_hfConfig.ApiPath,cb="//s1.hfcdn.com",db=window.HF.messages,eb="is-curr",fb="is-active",gb="is-hide",hb="is-error",ib="is-disable",jb="lazy-loading",kb="m-paging-lazy",lb="m-paging-empty",mb={addHouse:"isBuyDetailAddHouse",notifyLowerPrice:"isBuyDetailLowerPrice",addBuilding:"isBuyDetailAddBuilding",notifyBuildingNewCase:"isBuyDetailBuildingNewCase"},nb="hfid-",ob={current:cb+"/fp/hf/img/buy/markers/ico_current.png",traffic:cb+"/fp/hf/img/buy/markers/ico_traffic.png",life:cb+"/fp/hf/img/buy/markers/ico_life.png",hospital:cb+"/fp/hf/img/buy/markers/ico_hospital.png",education:cb+"/fp/hf/img/buy/markers/ico_education.png",leisure:cb+"/fp/hf/img/buy/markers/ico_leisure.png",hate:cb+"/fp/hf/img/buy/markers/ico_hate.png"},pb=$("#side"),qb=pb.parent(),rb=pb.find(".side-section"),sb=$("#agent-section"),tb=$("#map-section"),ub=$("#house-list-section"),vb=$("#reservation-form"),wb=$("#reservation-form-loading"),xb=navigator.userAgent.match(/msie 8.0/i)?!0:!1,yb=window.HF.tools,zb=0,Ab=0,Bb="",Cb=0,Db=0,Eb={},Fb=!1,Gb={};e=function(a){var b=(new Date).getTime(),c=window.location.href,d=-1!==c.indexOf("?")?c+"&v="+b:c+"?v="+b;window.open("http://www.facebook.com/share.php?u="+encodeURIComponent(d),"_blank","width=600,height=400"),a.preventDefault()},f=function(a){var b=$(this);b.CiRoBox({backdropclose:!0,click:!1,height:700,width:620,url:b.attr("href")}),a.preventDefault()},g=function(a){var b=$(this);b.CiRoBox({backdropclose:!0,click:!1,height:600,width:620,url:b.attr("href")}),a.preventDefault()},h=function(a){var b,c=$(this);I(mb.addHouse,"0"),b={Method:"AddHouse",Data:{SRC:" /buy/house/"+Eb.hfId+"/",HFID:Eb.hfId}},$.ajax({url:bb+"ashx/Buy/New/MyNotes.ashx",type:"GET",dataType:"jsonp",data:"RequestPackage="+JSON.stringify(b),success:function(a){var b,d=parseInt(a.Status,10),e=parseInt(a.StatusCode,10),f="";if(-1===d||1===d&&5===e)return void yb.showError();switch(b=a.Data,e){case 1:f="#lightbox-add-house-success";var g=$(f),h=parseInt(b.amount,10),i=parseInt(b.total,10),j=i-h>0?i-h:0;g.find(".amount").text(h),g.find(".remaining").text(j),g.find(".b-lightbox-hd .name").html(decodeURIComponent(b.MemberName)+"您好！");break;case 2:f="#lightbox-add-house-duplicate",$(f).find(".b-lightbox-hd .name").html(decodeURIComponent(b.MemberName)+"您好！");break;case 3:f="#lightbox-add-house-limit",$(f).find(".b-lightbox-hd .name").html(decodeURIComponent(b.MemberName)+"您好！");break;case 4:f="#lightbox-add-house-nonlogin"}c.CiRoBox({backdropclose:!0,click:!1,content:f,width:620})},error:function(){yb.showError()}}),a.preventDefault()},i=function(a){I(mb.addHouse,"1"),window.location.href=$(this).attr("href"),a.preventDefault()},j=function(a){var b,c=$(this);I(mb.notifyLowerPrice,"0"),b={Method:"GetLowPrice",Data:{SRC:" /buy/house/"+Eb.hfId+"/",HFID:Eb.hfId}},$.ajax({url:bb+"ashx/Buy/New/MyNotes.ashx",type:"GET",dataType:"jsonp",data:"RequestPackage="+JSON.stringify(b),success:function(a){var b,d=parseInt(a.Status,10),e=parseInt(a.StatusCode,10),f="";if(-1===d||1===d&&5===e)return void yb.showError();switch(b=a.Data,e){case 1:f="#lightbox-lower-price-success",$(f).find(".b-lightbox-hd .name").html(decodeURIComponent(b.MemberName)+"您好！");break;case 2:f="#lightbox-lower-price-duplicate",$(f).find(".b-lightbox-hd .name").html(decodeURIComponent(b.MemberName)+"您好！");break;case 3:f="#lightbox-lower-price-limit",$(f).find(".b-lightbox-hd .name").html(decodeURIComponent(b.MemberName)+"您好！");break;case 4:f="#lightbox-lower-price-nonlogin"}c.CiRoBox({backdropclose:!0,click:!1,content:f,width:620})},error:function(){yb.showError()}}),a.preventDefault()},k=function(a){I(mb.notifyLowerPrice,"1"),window.location.href=$(this).attr("href"),a.preventDefault()},l=function(a){var b,c=$(this);I(mb.addBuilding,"0"),b={Method:"AddBuilding",Data:{SRC:" /buy/house/"+Eb.buildingId+"/",BuildingID:Eb.buildingId}},$.ajax({url:bb+"ashx/Buy/New/MyNotes.ashx",type:"GET",dataType:"jsonp",data:"RequestPackage="+JSON.stringify(b),success:function(a){var b,d=parseInt(a.Status,10),e=parseInt(a.StatusCode,10),f="";if(-1===d||1===d&&5===e)return void yb.showError();switch(b=a.Data,e){case 1:f="#lightbox-add-building-success";var g=$(f),h=parseInt(b.amount,10),i=parseInt(b.total,10),j=i-h>0?i-h:0;g.find(".amount").text(h),g.find(".remaining").text(j),g.find(".b-lightbox-hd .name").html(decodeURIComponent(b.MemberName)+"您好！");break;case 2:f="#lightbox-add-building-duplicate",$(f).find(".b-lightbox-hd .name").html(decodeURIComponent(b.MemberName)+"您好！");break;case 3:f="#lightbox-add-building-limit",$(f).find(".b-lightbox-hd .name").html(decodeURIComponent(b.MemberName)+"您好！");break;case 4:f="#lightbox-add-building-nonlogin"}c.CiRoBox({backdropclose:!0,click:!1,content:f,width:620})},error:function(){yb.showError()}}),a.preventDefault()},m=function(a){I(mb.addBuilding,"1"),window.location.href=$(this).attr("href"),a.preventDefault()},n=function(a){I(mb.notifyBuildingNewCase,"1"),window.location.href=$(this).attr("href"),a.preventDefault()},o=function(a){jQuery.fn.CiRoBoxClose&&jQuery.fn.CiRoBoxClose(),a.preventDefault()},p=function(a){var b=$(a.currentTarget).closest(".m-choice");b.find('input[type="checkbox"]').prop("checked")?b.removeClass(eb):b.addClass(eb)},q=function(){if(vb.find(".form-group-gender .m-choice.is-single").removeClass(eb),$(this).closest(".m-choice").addClass(eb),xb){var a=vb.find(".form-group-gender .m-choice.is-single .m-icon"),b=$(this).find(".m-icon");a.removeClass("m-icon-choice-single"),setTimeout(function(){a.addClass("m-icon-choice-single"),b.addClass("m-icon-choice-single")},0)}},r=function(){$(this).closest(".m-choice").addClass(eb);var a=vb.find(".form-group-time .m-choice").not(".is-single");a.each(function(a,b){if($(b).removeClass(eb),$(b).find('input[type="checkbox"]').prop("checked",!1),xb){var c=$(b).find(".m-icon");c.removeClass("m-icon-choice"),setTimeout(function(){c.addClass("m-icon-choice")},0)}})},s=function(a){p(a);var b=$("#reservation-radio-time").closest(".m-choice");if(b.removeClass(eb),b.find('input[type="radio"]').prop("checked",!1),xb){var c=b.find(".m-icon");c.removeClass("m-icon-choice-single"),setTimeout(function(){c.addClass("m-icon-choice-single")},0)}},t=function(){var a=vb.find(".form-fieldset-extra-info");a.removeClass(gb)},u=function(){var a=vb.find('textarea[name="message"]'),b=a.closest(".m-form-group"),c=b.find(".m-form-help-block");b.removeClass(hb),c.length||(c=$('<p class="m-form-help-block"></p>')),c.html("字數限制："+a.val().length+"/"+Db).appendTo(b)},v=function(a){if($(this).find(".contact").hasClass("contact-incomplete")){$(".action-view-phone").find(".contact").removeClass("contact-incomplete");var b={Method:"Inquire",Data:{HFID:Eb.hfId}};$.ajax({url:bb+"ashx/Buy/New/HousePhoneHit.ashx",type:"GET",dataType:"jsonp",data:"RequestPackage="+JSON.stringify(b),success:function(a){var b=parseInt(a.Status,10),c=parseInt(a.StatusCode,10),d=a.Data;if(-1===b||1===b&&(0===c||-1===c))return void yb.showError();d.HitID&&_dmq.push(["_setTransaction","0",d.HitID]);var e=L(),f="",g="";e.utm_source?(f=Eb.hfId,e.utm_content&&(f=f+"_"+e.utm_content),f+="_TEL",g=e.utm_source):(f=Eb.hfId+"_TEL",g=window.location.host),N({transactionId:f,affiliation:g,skuCode:Eb.caseNo,productName:Eb.caseName,category:""})},error:function(){yb.showError()}}),a.preventDefault()}},w=function(a){var b=$(this).attr("data-target");$(this).CiRoBox({backdropclose:!0,click:!1,content:b,width:620}),a.preventDefault()},x=function(){var a,b=$("#down-payment"),c=$("#loan-principal"),d=$("#loan-rate"),e=$("#loan-year"),f=b.val().replace(/[^0-9]+/gi,""),g=c.val().replace(/[^0-9]+/gi,""),h=d.val().replace(/[^0-9\.]+/gi,""),i=e.val().replace(/[^0-9]+/gi,""),j=0,k=$(this).attr("id"),l=b.closest(".m-form-group"),m=c.closest(".m-form-group"),n=d.closest(".m-form-group");switch(f=1e4*(parseInt(f,10)||0),g=1e4*(parseInt(g,10)||0),i=parseInt(i,10)||0,a='<p class="m-form-help-block">您輸入的金額已超過此房屋價格囉！請重新輸入正確金額。</p>',k){case"down-payment":l.removeClass(hb),l.find(".m-form-control-col p").remove(),g=Cb-f,f>Cb&&(l.addClass(hb),l.find(".m-form-control-col").append($(a)));break;case"loan-principal":m.removeClass(hb),m.find(".m-form-control-col p").remove(),f=Cb-g,g>Cb&&(m.addClass(hb),m.find(".m-form-control-col").append($(a)));break;case"loan-rate":n.removeClass(hb),n.find(".m-form-control-col p").remove(),parseFloat(h)>100&&(n.addClass(hb),n.find(".m-form-control-col").append($('<p class="m-form-help-block">請勿輸入超過100%的利率唷！請重新輸入正確利率。</p>')))}b.val(parseInt(f/1e4,10)),c.val(parseInt(g/1e4,10)),d.val(h),e.val(i),j=parseInt(U(g,parseFloat(h),i),10),j=T(j.toString()),$("#monthly-payment").text(j),$("#monthly-payment-amount").text("$"+j)},y=function(a){var b=$(this).closest("li"),c=$(this).attr("data-type");if($.isEmptyObject(Gb["default"])||$.each(Gb["default"],function(a,b){Y(b,!0)}),b.hasClass(fb))b.removeClass(fb),Gb[c]&&Y(Gb[c]);else{if(b.addClass(fb),Gb[c])return void Z(Gb[c]);$.ajax({url:bb+"ashx/Buy/GetPOI.ashx",type:"GET",dataType:"json",data:{POIType:c,Lng:Eb.lng,Lat:Eb.lat,Distance:500},success:function(a){a.POI.length&&(Gb[c]=[],X({type:c,data:a.POI,markers:Gb[c]}))},error:function(){yb.showError()}})}a.preventDefault()},z=function(){var e=$(this).closest("li").data("poi"),f=new google.maps.LatLng(e.lat,e.lng),g=[];d&&clearTimeout(d),d=setTimeout(function(){c?(c.setPosition(f),c.setIcon(ob[e.type]),c.setMap(a)):c=new google.maps.Marker({position:f,map:a,icon:ob[e.type],title:e.name}),g=['<div class="map-infowindow">','<h4 class="heading">'+e.name+"</h4>","</div>"],b?(b.close(),b.setContent(g.join(""))):b=new google.maps.InfoWindow({content:g.join(""),maxWidth:250}),b.open(a,c)},200)},A=function(){d&&clearTimeout(d),c&&c.setMap(null),b&&b.close()},B=function(){if($(this).hasClass(kb)){var a={Method:"Inquire",Data:{HFID:Eb.hfId}};$.ajax({url:bb+"ashx/Buy/New/DetailObjView.ashx",type:"GET",dataType:"jsonp",data:"RequestPackage="+JSON.stringify(a),success:function(a){{var b=parseInt(a.Status,10),c=parseInt(a.StatusCode,10);a.Data}if(-1===b||1===b&&-1===c)return void yb.showError();var d=$(".m-paging-btn-prev"),e=$(".m-paging-btn-next");$.each(a.Data,function(a,b){b=$.parseJSON(b);var c,f="Prev"===a?d:e,g=f.find(".m-paging-main"),h=[];$.isEmptyObject(b)?(g.html("無推薦物件"),f.css("cursor","default"),f.removeClass(kb).addClass(lb)):(c=$('<div class="m-paging-thumb"></div>'),f.attr("href","/buy/house/"+b.HFID),h=['<div class="m-paging-info">','<h4 class="m-paging-heading"><em>'+decodeURIComponent(b.Address)+"</em>"+b.RegArea+"坪</h4>",'<div class="m-paging-minor">'+decodeURIComponent(b.Room)+"</div>",'<div class="m-paging-major"><em>'+b.Price+"</em>萬</div>","</div>"],G(b.Pic01,function(a){$(a).appendTo(c),g.html(""),g.append(c).append($(h.join(""))),f.removeClass(kb)}))})},error:function(){yb.showError()}})}},G=function(a,b){var c=new Image;c.onload=function(){b&&b(c)},c.onerror=function(){PicFilter(this,0),b&&b(c)},c.src=a},H=function(a){if(window.sessionStorage){var b=window.sessionStorage.getItem(a)?window.sessionStorage.getItem(a):"{}",c=$.isNumeric($.parseJSON(b))?{}:$.parseJSON(b),d=nb+Eb.hfId;return parseInt(c[d],10)}},I=function(a,b){if(window.sessionStorage){var c=window.sessionStorage.getItem(a)?window.sessionStorage.getItem(a):"{}",d=$.isNumeric($.parseJSON(c))?{}:$.parseJSON(c),e=nb+Eb.hfId;d[e]=b,window.sessionStorage.setItem(a,JSON.stringify(d))}},J=function(){var a=$(this).scrollTop(),b=tb.length?tb:ub;if(a>=zb&&b.length){var c=a-qb.offset().top+Ab;c+rb.height()>=b.position().top&&(c=b.position().top-rb.height()),pb.css("top",c)}else pb.css("top",Ab)},R=function(){var a,b=vb.find('input[name="email"]'),c=vb.find(".form-fieldset-sign-up");a={Method:"Inquire",Data:{Email:encodeURIComponent(b.val())}},$.ajax({url:bb+"ashx/Buy/New/QueryMember.ashx",type:"GET",dataType:"jsonp",data:"RequestPackage="+JSON.stringify(a),success:function(a){var b=parseInt(a.Status,10),d=parseInt(a.StatusCode,10);return-1===b||1===b&&0===d?void yb.showError():void(1===d?c.removeClass(gb):2===d&&c.addClass(gb))},error:function(){yb.showError()}})},S=function(a){I(mb.notifyBuildingNewCase,"0");var b={Method:"AddBuildingNewCase",Data:{BuildingID:Eb.buildingId}};$.ajax({url:bb+"ashx/Buy/New/MyNotes.ashx",type:"GET",dataType:"jsonp",data:"RequestPackage="+JSON.stringify(b),success:function(b){var c,d=parseInt(b.Status,10),e=parseInt(b.StatusCode,10),f="";if(-1===d||1===d&&5===e)return void yb.showError();switch(c=b.Data,e){case 1:f="#lightbox-notify-building-newcase-success",$(f).find(".b-lightbox-hd .name").html(decodeURIComponent(c.MemberName)+"您好！");break;case 2:f="#lightbox-notify-building-newcase-duplicate",$(f).find(".b-lightbox-hd .name").html(decodeURIComponent(c.MemberName)+"您好！");break;case 3:f="#lightbox-notify-building-newcase-limit",$(f).find(".b-lightbox-hd .name").html(decodeURIComponent(c.MemberName)+"您好！");break;case 4:f="#lightbox-notify-building-newcase-nonlogin"}a.CiRoBox({backdropclose:!0,click:!1,content:f,width:620})},error:function(){yb.showError()}})},T=function(a){return a.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")},U=function(a,b,c){var d=0,e=0,f=0,g=0;return a>0&&b>0&&c>0&&(d=b/100/12,e=12*c,f=Math.pow(1+d,e)*d/(Math.pow(1+d,e)-1),g=a*f),g},V=function(){var a={Method:"Inquire",Data:{HFID:Eb.hfId}};$.ajax({url:bb+"ashx/Buy/new/GetLivingNear.ashx",type:"GET",dataType:"jsonp",data:"RequestPackage="+JSON.stringify(a),success:function(a){var b=parseInt(a.Status,10),c=parseInt(a.StatusCode,10);return-1===b||1===b&&0===c?void yb.showError():void W(a.Data.near)},error:function(){yb.showError()}})},W=function(a){var b=tb.find(".info");b.html(""),$.each(a,function(a,c){var d;d={name:decodeURIComponent(c.Name),distance:c.Distance,lat:parseFloat(c.Lat,10),lng:parseFloat(c.Lng,10),type:c.TypeName},$("<li></li>").data("poi",d).html('<a href="javascript:;">到 <em title="'+d.name+'">'+d.name+"</em> "+d.distance+"公尺</a>").appendTo(b)}),b.find("li a").hover(z,A)},X=function(c){$.each(c.data,function(d,e){var f,g=parseFloat(e.Lat,10),h=parseFloat(e.Lng,10);b||(b=new google.maps.InfoWindow({content:"",maxWidth:250})),f=new google.maps.Marker({position:new google.maps.LatLng(g,h),map:a,icon:ob[c.type],title:decodeURIComponent(e.Name)+"("+decodeURIComponent(e.Title)+")"}),google.maps.event.addListener(f,"click",function(){var c=['<div class="map-infowindow">','<h4 class="heading">'+decodeURIComponent(e.Name)+"("+decodeURIComponent(e.Title)+")</h4>","<p>"+decodeURIComponent(e.Address)+"</p>","</div>"];b.setContent(c.join("")),b.open(a,f)}),c.markers.push(f)})},Y=function(a,b){if(a.length)for(var c=a.length-1;c>=0;c--){var d=a[c];d.setMap(null),b&&a.pop()}},Z=function(b){$.each(b,function(b,c){c.setMap(a)})},_=function(a){var b={Method:"Inquire",Data:{Page:1,SearchMode:5,HFID:Eb.hfId}};$.ajax({url:bb+"ashx/Buy/New/GetBuyList.ashx",type:"GET",dataType:"jsonp",data:"RequestPackage="+JSON.stringify(b),success:function(b){var c=parseInt(b.Status,10),d=parseInt(b.StatusCode,10);if(-1===c||1===c&&0===d)return void yb.showError();var e=$.parseJSON(b.Data.ListObjects),f=[],g=ub.find(".m-thumbnail-bd");e.length&&(g.html(""),$.each(e,function(a,b){f.push('<section class="m-thumbnail-item">'),f.push('<a class="ga_click_trace" href="'+bb+"buy/house/"+b.HFID+'" target="_blank" ga_cat="detail_more_house" ga_event="click" ga_label="detail_more_house_'+(a+1)+'">'),f.push('<div class="m-thumbnail-item-hd m-thumbnail-figure">'),f.push('<figure class="m-thumbnail-figure-bd b-middleSet">'),f.push('<div class="'+jb+'" data-alt="'+b.CaseName+'" data-src="'+b.CoverPic+'"></div>'),f.push("</figure>"),f.push("</div>"),f.push('<div class="m-thumbnail-item-bd">'),f.push('<h2 class="casename">'+b.CaseName+"</h2>"),f.push('<div class="price">'),b.LastPrice&&f.push('<span class="original-price"><em class="number">'+b.LastPrice+'</em><em class="postfix">萬</em></span>'),f.push('<span class="discount-price"><em class="number">'+b.Price+'</em><em class="postfix">萬</em></span>'),f.push("</div>"),f.push("</div>"),f.push("</a>"),f.push("</section>")}),g.html(f.join("")),ub.removeClass(gb),$.isFunction(a)&&a())},error:function(){yb.showError()}})},ab=function(){if(!ub.hasClass(gb)){var a=ub.find(".m-thumbnail-bd");a.find("."+jb).each(function(a,b){var c=$(b);G(c.attr("data-src"),function(a){a.alt=c.attr("data-alt"),c.fadeIn(1e3,function(){c.replaceWith($(a))})})})}},K=function(){var a=new Date,b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate(),e=a.getHours(),f=a.getMinutes(),g=a.getSeconds(),h=[],i="000"+Math.floor(1e3*Math.random()).toString();return h=[b,c>=10?c:"0"+c,d>=10?d:"0"+d,e>=10?e:"0"+e,f>=10?f:"0"+f,g>=10?g:"0"+g],h.join("")+i.substring(i.length,i.length-3)},L=function(){var a={};if(-1!==window.location.href.indexOf("?")){var b=window.location.href.split("?")[1].split("&");$.each(b,function(b,c){var d=c.split("=");a[d[0]]=d[1]})}return a},M=function(){if("undefined"==typeof DoObjectTrack)return void setTimeout(arguments.callee,100);var a="/"+encodeURIComponent("買屋"),b=0,c="",d=[];Eb.wmRefUrl?(c=Eb.wmRefUrl,b=0):(c=document.referrer?document.referrer:window.location.href,b="http://buy.housefun.com.tw/"===c||-1!==c.indexOf(a)?0:1),d.push([1,"3"]),d.push([2,b]),d.push([3,"1"]),d.push([4,Eb.caseId]),d.push([5,c]),DoObjectTrack(d)},N=function(a){"undefined"!=typeof dataLayer&&dataLayer.push({transactionId:a.transactionId,transactionAffiliation:a.affiliation,transactionTotal:1,transactionProducts:[{sku:a.skuCode,name:a.productName,category:a.category,price:1,quantity:1}],event:"trackTrans"})},O=function(a,b){var c=[];c.push([1,K()]),c.push([2,a]),c.push([3,"HF_買屋物件明細頁"]),c.push([4,b]),c.push([5,Eb.caseId]),DoMessage(c)},P=function(){var a="我在好房HouseFun看見物件請與我聯絡，謝謝。";vb.find('input[type="text"], input[type="password"]').val(""),vb.find('textarea[name="message"]').val(a),vb.find(".m-choice").removeClass(fb),vb.find(".form-group-gender .m-choice.is-single").eq(0).addClass(fb),vb.find(".form-group-time .m-choice").eq(0).addClass(fb),vb.find(".m-form-group").removeClass(hb),vb.find(".m-form-help-block").html(""),vb.find(".form-group-message").append($('<p class="m-form-help-block">字數限制：'+a.length+"/"+Db+"</p>")),vb.find(".form-fieldset-sign-up").addClass(gb),vb.find(".form-container-password").addClass(gb),vb.find("fieldset").prop("disbled",!1),vb.find(".m-button").prop("disabled",!1),vb.find(".action-submit").prop("disabled",!1).removeClass(ib)},Q=function(){var a={Method:"Inquire"};$.ajax({url:bb+"ashx/Buy/New/QueryLoginStatus.ashx",type:"GET",dataType:"jsonp",data:"RequestPackage="+JSON.stringify(a),success:function(a){if(-1!==parseInt(a.Status,10)){var b=parseInt(a.StatusCode,10);if(0===b||-1===b)yb.showError();else if(1===b){Fb=!0;var c=a.Data,d=c.Sexual?c.Sexual:"1";vb.find('input[name="last_name"]').val(decodeURIComponent(c.UserFName)),vb.find('input[name="first_name"]').val(decodeURIComponent(c.UserLName)),vb.find('input[name="email"]').val(c.ContactEmail),vb.find('input[name="phone"]').val(c.MobilPhoneNumber),vb.find(".form-group-gender .m-choice.is-single").removeClass(fb),vb.find('.form-group-gender .m-choice.is-single input[name="gender"]').prop("checked",!1),vb.find(".form-group-gender .m-choice.is-single").each(function(a,b){var c=$(b).find('input[name="gender"]');c.val()===d&&($(b).addClass(fb),c.prop("checked",!0))})}}},error:function(){yb.showError()}})},D=function(){Bb=$("#profile-name").html(),Db=vb.find('textarea[name="message"]').attr("maxLength"),vb.find("input[placeholder], textarea").placeholder(),Q(),vb.find('input[name="email"]').on("focus",t),vb.find(".action-submit").on("click",t),vb.find(".form-group-gender .m-choice-btn").on("click",q),vb.find(".form-group-time .m-choice.is-single .m-choice-btn").on("click",r),vb.find('.form-group-time .m-choice:not(".is-single") .m-choice-btn').on("click",s),vb.find(".form-group-sign-up .m-choice-btn").on("click",function(a){p(a);var b=vb.find(".form-container-password");$(this).closest(".m-choice").find('input[type="checkbox"]').prop("checked")?b.addClass(gb):b.removeClass(gb)}),vb.find(".form-group-agreement .m-choice-btn").on("click",p),vb.find('.form-group-message textarea[name="message"]').on("keyup",u),$("#form1").validate({onkeyup:!1,rules:{last_name:{nameRequired:".form-control-first-name",nameEachRequired:!0},first_name:{nameRequired:".form-control-last-name",nameEachRequired:!0},email:{required:!0,emailValid:!0},phone:{required:!0,digits:!0,rangelength:[9,10]},time:{timeRequired:[$("#reservation-radio-time"),vb.find('input[name="time"]')]},message:{required:!0},agreement:{required:!0},password:{required:function(){return $("#reservation-checkbox-sign-up:checked").length>0},rangelength:[6,20]},confirm_pwd:{required:function(){return $("#reservation-checkbox-sign-up:checked").length>0},rangelength:[6,20],equalTo:vb.find('input[name="password"]')}},messages:{last_name:{nameRequired:db.name_required,nameEachRequired:db.last_name_required},first_name:{nameRequired:db.name_required,nameEachRequired:db.first_name_required},email:{required:db.email_required,emailValid:db.email_valid},phone:{required:db.phone_required,digits:db.phone_valid,rangelength:db.phone_length},time:{timeRequired:db.contact_time_required},message:{required:db.message_required},agreement:{required:db.agreement_required},password:{required:db.password_required,rangelength:db.password_length},confirm_pwd:{required:db.password_required,rangelength:db.password_length,equalTo:db.password_equal}},onclick:function(a){$(a).valid()},onfocusout:function(a){$(a).valid()},invalidHandler:function(){},submitHandler:function(){wb.find(".b-loading-bd").css("height",vb.outerHeight()),wb.removeClass(gb),vb.find("fieldset").prop("disbled",!0),vb.find(".m-button").prop("disabled",!0);var a=vb.find('input[name="choice_time"]:checked'),b=vb.find('input[name="time"]:checked'),c=vb.find('input[name="sign_up"]:checked'),d=[],e=$.trim(vb.find('input[name="email"]').val()),f=$.trim(vb.find('input[name="phone"]').val()),g={};return a.length?d.push(a.val()):b.each(function(a,b){d.push($(b).val())}),g={Method:"Inquire",Data:{FirstName:encodeURIComponent($.trim(vb.find('input[name="last_name"]').val())),LastName:encodeURIComponent($.trim(vb.find('input[name="first_name"]').val())),Sexual:vb.find('input[name="gender"]:checked').val(),Email:encodeURIComponent(e),PhoneNumber:f,BecomeMember:c.length?"Y":"N",FreeTime:d.join(","),Memo:encodeURIComponent($.trim(vb.find('textarea[name="message"]').val())),Password:c.length?vb.find('input[name="password"]').val():"",HFID:Eb.hfId,CaseID:Eb.caseId,MessageType:Eb.messageType,ShopID:Eb.shopId,WebMaxMsgCode:K(),AssignBuilding:encodeURIComponent(Eb.assignBuilding),County:encodeURIComponent(Eb.county),District:encodeURIComponent(Eb.district),Road:encodeURIComponent(Eb.road)}},$.ajax({url:bb+"ashx/Buy/New/LeaveMessage.ashx",type:"GET",dataType:"jsonp",data:"RequestPackage="+JSON.stringify(g),beforeSend:function(){vb.find(".action-submit").prop("disabled",!0).addClass(ib)},success:function(a){if(wb.addClass(gb),P(),-1===parseInt(a.Status,10))return void yb.showError();var b=parseInt(a.StatusCode,10),c=a.Data;if(0===b)yb.showError();else if(1===b){a.Data.MessageID&&_dmq.push(["_setTransaction","1","01-"+c.MessageID]),O(e,f);var d=L(),g=Eb.hfId,h="",i="";d.utm_source?(d.utm_content&&(g=g+"_"+d.utm_content),h=i=d.utm_source):h=window.location.host,N({transactionId:g,affiliation:h,skuCode:i,productName:Eb.caseName,category:Eb.messageType}),alert("留言成功! 謝謝您! 我們已將您的留言傳送給【"+Bb+"】，如聯繫上有任何問體，請致電客服中心，謝謝。好房網客服專線:412-8668 (手機直撥請加02)")}},error:function(){wb.addClass(gb),P(),yb.showError()}}),!1},highlight:function(a){"reservation-form"===$(a).closest(".m-form").attr("id")&&$(a).closest(".m-form-group").addClass(hb)},unhighlight:function(a){"reservation-form"===$(a).closest(".m-form").attr("id")&&($(a).closest(".m-form-group").removeClass(hb),$(a).closest(".m-form-group").find(".m-form-help-block").remove(),Fb||"email"!==$(a).attr("name")||R(),u())},errorPlacement:function(a,b){if("reservation-form"===$(b).closest(".m-form").attr("id")){b.closest(".m-form-group").find(".m-form-help-block").remove();var c=$('<p class="m-form-help-block"></p>').append(a);b.closest(".m-form-group").append(c)}}})},E=function(){Cb=1e4*(parseInt($("#total-amount").text().replace(",",""),10)||0);var a=.3*Cb,b=Cb-a;$("#down-payment").val(parseInt(a/1e4,10)),$("#loan-principal").val(parseInt(b/1e4,10)),$("#loan-rate").val(2),$("#loan-year").val(20),$("#down-payment, #loan-principal, #loan-rate, #loan-year").on("keyup",x)},F=function(){var b,c,d,e,f=document.getElementById("map-canvas"),g=new google.maps.LatLng(Eb.lat,Eb.lng);if(b=[{featureType:"administrative",elementType:"all",stylers:[{saturation:0}]},{featureType:"administrative.country",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"administrative.province",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"landscape",elementType:"all",stylers:[{saturation:-10}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"all",stylers:[{saturation:-10},{lightness:30},{visibility:"simplified"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:0},{hue:"#5EAB1F"},{lightness:0}]},{featureType:"road.highway",elementType:"label",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"all",stylers:[{saturation:-100},{lightness:20}]},{featureType:"road.arterial",elementType:"label",stylers:[{visibility:"on"}]},{featureType:"road.local",elementType:"label",stylers:[{visibility:"on"}]},{featureType:"transit",elementType:"all",stylers:[{saturation:-100}]},{featureType:"water",elementType:"all",stylers:[{hue:"#0089CF"},{saturation:-50},{lightness:30}]},{featureType:"administrative.land_parcel",elementType:"all",stylers:[{visibility:"on"}]}],c={zoom:17,maxZoom:19,minZoom:13,center:g,mapTypeId:google.maps.MapTypeId.ROADMAP,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL},scrollwheel:!1,styles:b},a=new google.maps.Map(f,c),e=a.getStreetView(),e.setPosition(a.getCenter()),Eb.isShift){var h=new google.maps.Circle({strokeWeight:0,fillColor:"#ff9933",fillOpacity:.35,map:a,center:g,radius:100});google.maps.event.addListener(h,"mouseover",function(){$(a.getDiv()).attr("title","物件位於此範圍內")}),google.maps.event.addListener(h,"mouseout",function(){$(a.getDiv()).attr("title","")})}else d=new google.maps.Marker({position:g,map:a,icon:ob.current,title:"目前物件位置"});var i=$('<div class="map-control"></div>').html('<a class="btn" draggable="false" href="javascript:;" title="街景">街景</a>');i.on("click",function(a){e.setVisible(!0),a.preventDefault()}),a.controls[google.maps.ControlPosition.TOP_RIGHT].push(i.get(0)),google.maps.event.addListener(a,"dragend",function(){e.setPosition(a.getCenter())}),google.maps.event.addListener(a,"maptypeid_changed",function(){var b=a.getMapTypeId();switch(b){case google.maps.MapTypeId.HYBRID:gtm_event_track("detail_map","detail_map_function_click","detail_map_function_Satellite imagery");break;case google.maps.MapTypeId.ROADMAP:gtm_event_track("detail_map","detail_map_function_click","detail_map_function_map");break;case google.maps.MapTypeId.TERRAIN:gtm_event_track("detail_map","detail_map_function_click","detail_map_function_landscape")}}),google.maps.event.addListener(e,"visible_changed",function(){e.getVisible()&&gtm_event_track("detail_map","detail_map_function_click","detail_map_function_Street View")}),V()},(C=function(){if(window.HF.tools.logResults(),Eb={hfId:$("#query-hf-id").val(),buildingId:$("#query-building-id").val(),caseId:$("#query-case-id").val(),messageType:$("#query-message-type").val(),shopId:$("#query-shop-id").val(),assignBuilding:$("#query-assign-building").val(),county:$("#query-county").val(),district:$("#query-district").val(),road:$("#query-road").val(),caseNo:$("#query-case-no").val(),caseName:$("#query-case-name").val(),isShift:parseInt($("#query-XYShift").val(),10),lng:parseFloat($("#query-lng").val(),10),lat:parseFloat($("#query-lat").val(),10),wmRefUrl:$("#query-wm-ref-url").val()},Eb.hfId){if(M(),zb=pb.offset().top,Ab=pb.position().top,J(),D(),E(),tb.length){var a={callback:F};"undefined"!=typeof gmap_client_id&&gmap_client_id&&$.extend({},a,{other_params:"client="+gmap_client_id+"&sensor=false"}),google.load("maps","3.9",a),tb.on("click",".tabs > li > a",y)}$(window).on("resize scroll",function(){J(),$(this).scrollTop()>=sb.offset().top-400&&ab()}),$(window).scrollTop()>=sb.offset().top-400?_(ab):_(),$("#action-share").on("click",e),$("#action-forward").on("click",f),$("#action-report").on("click",g),$("#action-add-house").on("click",h),$("#action-lower-price").on("click",j),$("#action-add-building").on("click",l),$("#lightbox-add-house-nonlogin").find(".action-sign-in, .action-sign-up").on("click",i),$("#lightbox-lower-price-nonlogin").find(".action-sign-in, .action-sign-up").on("click",k),$("#lightbox-add-building-nonlogin").find(".action-sign-in, .action-sign-up").on("click",m),$("#lightbox-notify-building-newcase-nonlogin").find(".action-sign-in, .action-sign-up",n),$("#lightbox-add-house-success").find(".action-notify-lower-price").on("click",function(a){$("#action-lower-price").trigger("click"),a.preventDefault()}),$("#lightbox-add-building-success").find(".action-notify-building-newcase").on("click",function(a){S($("#action-add-building")),a.preventDefault()}),$("#lightbox-add-house-success").find(".action-view").on("click",o),$("#lightbox-lower-price-success").find(".action-view").on("click",o),$("#lightbox-add-building-success").find(".action-view").on("click",o),$("#lightbox-notify-building-newcase-success").find(".action-view").on("click",o),$("#lightbox-notify-building-newcase-duplicate").find(".action-view").on("click",o),H(mb.addHouse)&&$("#action-add-house").trigger("click"),H(mb.notifyLowerPrice)&&$("#action-lower-price").trigger("click"),H(mb.addBuilding)&&$("#action-add-building").trigger("click"),H(mb.notifyBuildingNewCase)&&$("#lightbox-add-building-success").find(".action-notify-building-newcase").trigger("click"),$(".action-view-phone").on("click",v),$("#badge-list").on("click","li > a",w),$(".m-icon-question-circle").each(function(a,b){$(b).mtooltip({title:"電話不通 ？",content:"部分節費系統無法撥打本服務專線，請改用其他市話或其他電信業者（如：中華電信、遠傳、台灣大哥大、亞太、威寶）撥打。",container:".detail-content"})}),$("#action-land-building").mpopover({title:"謄本資料",content:$("#popover-land-building").find(".popover-content"),container:".detail-content",placement:"upper-left"}),$("#action-caculation").mpopover({title:"簡易房貸試算公式",content:$("#popover-caculation").find(".popover-content"),container:".detail-content",placement:"upper-left"}),$(".m-paging-btn-prev, .m-paging-btn-next").on("mouseenter",B)}})()}),$(function(){fn=function(){}});